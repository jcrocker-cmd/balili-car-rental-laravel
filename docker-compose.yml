version: "3.9"

services:
    laravel:
        container_name: balili-car-rental
        build:
            context: .
            dockerfile: Dockerfile
        image: balili-car-rental:latest
        ports:
            - "8085:80" # Expose only for testing; NPM will handle public 80/443
        env_file:
            - .env # Use your existing environment file
        volumes:
            - .:/var/www/html # Mount code for live updates
        networks:
            - sail
            - proxy
        depends_on:
            - mysql

    mysql:
        container_name: balili-car-rental-mysql
        image: mysql/mysql-server:8.0
        restart: always
        env_file:
            - .env # Reads DB_DATABASE, DB_USERNAME, DB_PASSWORD, etc.
        ports:
            - "3306:3306" # Optional: only if you want external DB access
        volumes:
            - sail-mysql:/var/lib/mysql
        networks:
            - sail
        healthcheck:
            test: ["CMD", "mysqladmin", "ping", "-p${DB_PASSWORD}"]
            retries: 5
            timeout: 5s

networks:
    sail:
        driver: bridge
    proxy:
        external: true # Connects to your existing Nginx Proxy Manager network

volumes:
    sail-mysql:
        driver: local
